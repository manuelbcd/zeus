version: '3'

services:

  nginx:

    build:
        context: .
        dockerfile: nginx.dockerfile
        args:
          - NGINX_VERSION=${NGINX_VERSION}

    image: ${NGINX_CONTAINER_NAME}:${NGINX_VERSION}
    
    container_name: ${NGINX_CONTAINER_NAME}

    depends_on:
      - go

    ports:
       - ${NGINX_PORT}:80

    stdin_open: true
    tty: true

  redis:

    image: redis:${REDIS_VERSION}

    container_name: ${REDIS_CONTAINER_NAME}

    stdin_open: true
    tty: true

  mongo:

    image: mongo:${MONGO_VERSION}

    container_name: ${MONGO_CONTAINER_NAME}

    ports:
      - ${MONGO_PORT}:${MONGO_PORT}

    stdin_open: true
    tty: true

  go:

      build:
        context: .
        dockerfile: go.dockerfile
        args:
          - PROJECT_NAME=${PROJECT_NAME}
          - GOPATH=${GOPATH}
          - GO_VERSION=${GO_VERSION}
          - GO_PORT=${GO_PORT}
          - PROJECT_CONTAINER_PATH=${PROJECT_CONTAINER_PATH}

      image: ${GO_CONTAINER_NAME}:${GO_VERSION}
      
      container_name: ${GO_CONTAINER_NAME}
      
      volumes:
        - ${PROJECT_HOST_PATH}:${PROJECT_CONTAINER_PATH}

      depends_on:
        - redis
        - mongo

      environment:

        ## HOST ENVIRONMENT VARIABLES
        ## GITHUB_CLIENT_SECRET
        ## GITHUB_CLIENT_ID

        - GITHUB_CLIENT_ID
        - GITHUB_CLIENT_SECRET
        - LISTENING_ADDRESS
        - REDIS_ADDRESS
        - MONGO_PORT
        - MONGO_ADDRESS=mongo:${MONGO_PORT}

      stdin_open: true
      tty: true
